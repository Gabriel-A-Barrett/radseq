params {
    config_profile_description = 'The UConn HPC profile'
    config_profile_contact     = 'noah.reid@uconn.edu'
    config_profile_url         = 'https://bioinformatics.uconn.edu/'

    // max resources
    max_memory                 = 2.TB
    max_cpus                   = 64
    max_time                   = 14.d

    // Path to shared singularity images
    singularity_cache_dir      = '/isg/shared/databases/nfx_singularity_cache'

}

process {
    executor         = 'slurm'
    queue            = { task.memory <= 245.GB ? 'general' : ( task.memory <= 512.GB ? 'himem' : 'himem2' ) }
    
    //clusterOptions   = { [
    //    task.memory <= 245.GB ? '--qos=general' : '--qos=himem',
    //    task.process.tokenize(':')[-1].contains('BWAMEM2') ? '--constraint=AVX|AVX2|AVX512|SSE41|SSE42' : ''
    //].join(' ').trim() }


    // clusterOptions
    //def base_clusterOptions = { task.memory <= 245.GB ? '--qos=general' : '--qos=himem' } 
    //def bwamem2_clusterOptions = { "${task.process.tokenize(':')[-1]}" =~ /BWAMEM2.*/ ? '--constraint=AVX|AVX2|AVX512|SSE41|SSE42' : '' }
    //clusterOptions = base_clusterOptions + bwamem2_clusterOptions
    //clusterOptions = base_clusterOptions
    //withName: 'BWAMEM2.*' { clusterOptions = '--constraint=AVX|AVX2|AVX512|SSE41|SSE42' }

}

executor {
    name = 'slurm'
    submitRateLimit = '2 sec'
    queueSize       = 100
}

singularity {
    enabled        = true
    cacheDir       = params.singularity_cache_dir
    autoMounts     = true
    conda.enabled  = false
}